/*
 * relativeSlider 1.0.0 - multi level grouping indicators for tables
 * Version 1.0.0
 * @requires jQuery v1.6+ and jQuery.ui
 * 
 * Copyright (c) 2014 Perry Systems
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl.html
 */
/*
 * @description jQuery plugin to calculate the relative worth of individual sliders relative to the total selected value..
 * @example $('.skills-slider').relativeSlider('init');
 */
!function(e){e.fn.relativeSlider=function(a,r){var t={};if(t.callers=this,t.percentageFixer=function(e,a){function r(e,a){return Math.abs(e-a)/e}for(var t,n,i,l,s=e.length,o=0,c=0,u=[],h=e.length,v=[];s--;)c+=u[s]=Math.round(e[s]);for(t=a>c?1:-1;c!==a;){for(s=0;h>s;s++)n=s===h-1?0:s+1,l=r(e[n],u[n]+t),i=r(e[s],u[s]+t),i>l&&(o=n);u[o]+=t,c+=t}for(s=0;h>s;s++)v[s]=u[s]&&Math.abs(e[s]-u[s])/e[s];for(s=0;h>s;s++)for(o=0;h>o;o++)if(o!==s){var f=r(e[s],u[s]+1)+r(e[o],u[o]-1),d=r(e[s],u[s]-1)+r(e[o],u[o]+1),g=v[s]+v[o];g>f&&(u[s]=u[s]+1,u[o]=u[o]-1,v[s]=u[s]&&Math.abs(e[s]-u[s])/e[s],v[o]=u[o]&&Math.abs(e[o]-u[o])/e[o]),g>d&&(u[s]=u[s]-1,u[o]=u[o]+1,v[s]=u[s]&&Math.abs(e[s]-u[s])/e[s],v[o]=u[o]&&Math.abs(e[o]-u[o])/e[o])}return u},t.settings=e.extend({},r),t.onSliderChange=function(){var e=t.calculateSliders();t.settings.onChange.apply(t,[e])},t.calculateSliders=function(){var a={},r=0,n={},i=t.callers.length;t.callers.each(function(){var a=e(this),t=parseInt(a.slider("value"));r+=t,n[a.attr("id")]={value:t}});var l=[];for(var s in n)if(r>0){var o=100/r*n[s].value;l.push(o)}else{var o=100/i;l.push(o)}var c=t.percentageFixer(l,100),u=0;for(var s in n)n[s].percentage=c[u],u++;return a.totalValue=r,a.slidersCount=i,a.sliders=n,a},"init"===a){var n=t.callers.each(function(){var a=e(this),r=parseInt(a.text());e(this).empty().slider({value:r,min:0,max:100,range:"min",animate:!0,orientation:"horizontal",change:t.onSliderChange}).css({visibility:"visible"})});return t.onSliderChange(),n}return"calculate"===a?t.calculateSliders():void 0}}(jQuery);